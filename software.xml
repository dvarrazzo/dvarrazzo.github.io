<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title type="text">Software</title>
  <id>urn:uuid:345e7579-5b16-39e4-9f1d-2a4bff93035d</id>
  <updated>2020-02-29T00:00:00Z</updated>
  <link href="https://www.varrazzo.com/blog/" />
  <link href="https://www.varrazzo.com/software.xml" rel="self" />
  <author>
    <name></name>
  </author>
  <generator uri="https://github.com/t73fde/lektor-feed" version="20191006.1">Lektor Feed Plugin</generator>
  <entry xml:base="https://www.varrazzo.com/blog/2020/02/29/adventures-in-yaml-config/">
    <title type="text">Adventures in YAML config</title>
    <id>urn:uuid:a325926a-9137-3067-8700-5917960f7b5f</id>
    <updated>2020-02-29T00:00:00Z</updated>
    <link href="https://www.varrazzo.com/blog/2020/02/29/adventures-in-yaml-config/" />
    <author>
      <name>Daniele Varrazzo</name>
    </author>
    <content type="html">&lt;p&gt;Developing database-backed applications, I've often had the need to extract a
meaningful selection of data out of a production database. Maybe in order to
set up a development environment, or a testing environment, or to try out a
complex migration on smaller dataset.&lt;/p&gt;
&lt;p&gt;However a &lt;tt class=&quot;docutils literal&quot;&gt;pg_dump&lt;/tt&gt; of the production db is not necessarily a good idea:&lt;/p&gt;
&lt;ul class=&quot;simple&quot;&gt;
&lt;li&gt;the production data may be YUGE;&lt;/li&gt;
&lt;li&gt;the production data may contain sensitive information;&lt;/li&gt;
&lt;li&gt;some of the data in the production db might be bulky and irrelevant, for
instance audit tables.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Still, googling around, you don't get much to help: people still advise to use
&lt;tt class=&quot;docutils literal&quot;&gt;pg_dump&lt;/tt&gt; with a plethora of &lt;tt class=&quot;docutils literal&quot;&gt;&lt;span class=&quot;pre&quot;&gt;--table&lt;/span&gt;&lt;/tt&gt;, but this results in the need of
saving a script to keep the unwieldy command line, and still that does not
make you able to modify in any way the data dumped from the table, for
instance to omit the &lt;tt class=&quot;docutils literal&quot;&gt;password&lt;/tt&gt; column. You might use &lt;tt class=&quot;docutils literal&quot;&gt;COPY TO&lt;/tt&gt; for that,
but that's an entirely different beast from &lt;tt class=&quot;docutils literal&quot;&gt;pg_dump&lt;/tt&gt; and the resulting file
is &lt;em&gt;only&lt;/em&gt; data: not even the columns names. It will bear no context about how
it should be restored (and now that you dropped the &lt;tt class=&quot;docutils literal&quot;&gt;password&lt;/tt&gt; column the
data won't align anymore and you won't be able to just run a &lt;tt class=&quot;docutils literal&quot;&gt;COPY FROM&lt;/tt&gt;...)&lt;/p&gt;
&lt;p&gt;A few months ago I decided to scratch this itch properly, and I started
writing a tool that, after some improvements, was deemed to be good enough to
be stamped as 0.1. After some discussion about the meaning of &lt;em&gt;dump&lt;/em&gt; and what
a good synonym could have been (with references ranging from relation breakups
to more scatological ones) it was called &lt;a class=&quot;reference external&quot; href=&quot;https://github.com/dvarrazzo/pg_seldump&quot;&gt;pg_seldump&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The idea of the tool is to define a &lt;a class=&quot;reference external&quot; href=&quot;https://en.wikipedia.org/wiki/YAML&quot;&gt;YAML&lt;/a&gt; file containing a description of the
rule to apply to different database objects to dump. For instance:&lt;/p&gt;
&lt;pre class=&quot;code YAML literal-block&quot;&gt;
&lt;span class=&quot;c1&quot;&gt;# A YAML file is similar in content to a JSON file, but easier for human&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# to edit: more compact, less noisy, and can be commented.&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;db_objects&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;

  &lt;span class=&quot;c1&quot;&gt;# dump all the tables in the schema 'myapp'&lt;/span&gt;
  &lt;span class=&quot;p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;schema&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;myapp&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;action&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;dump&lt;/span&gt;

  &lt;span class=&quot;c1&quot;&gt;# but not the one starting with 'audit_'&lt;/span&gt;
  &lt;span class=&quot;p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;schema&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;myapp&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;names&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;^audit_.*&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;action&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;skip&lt;/span&gt;

  &lt;span class=&quot;c1&quot;&gt;# don't dump customers passwords, and replace their telephone no. with a dummy&lt;/span&gt;
  &lt;span class=&quot;p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;schema&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;myapp&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;customer&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;no_columns&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;password&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;replace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;telephone&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;+44&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;7853&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;123456&amp;quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;This description would produce a data-only dump as a text file containing the
data and enough statements to restore them by piping the entire file into
&lt;cite&gt;psql&lt;/cite&gt;.&lt;/p&gt;
&lt;p&gt;The program isn't finished yet, but it is already quite interesting: the
&lt;tt class=&quot;docutils literal&quot;&gt;pg_seldump&lt;/tt&gt; command takes in input one or more configuration files like the
one in the example and introspects the database looking for the objects to
dump. The objects are matched against all the rules and, inspired to CSS, it
picks the one with the highest selectivity. It also understand what fields use
what sequences, and if the field is dumped then the sequence state will be
saved as well.&lt;/p&gt;
&lt;p&gt;There is one large feature I'm about to develop: automatically navigating
foreign keys in order to collect all the data necessary to create a consistent
sample of the data. I started yesterday working at that feature, but
there is something else I wanted to do before...&lt;/p&gt;
&lt;div class=&quot;section&quot; id=&quot;what-s-into-a-configuration-file&quot;&gt;
&lt;h3&gt;What's into a configuration file?&lt;/h3&gt;
&lt;p&gt;So far, the program had a &lt;a class=&quot;reference external&quot; href=&quot;https://github.com/dvarrazzo/pg_seldump/blob/96c811b272130d7492c62ba89216ab537dbd4d41/seldump/dumprule.py#L103&quot;&gt;parser for the configuration file&lt;/a&gt; to create
&amp;quot;rule&amp;quot; objects out of what found in the YAML. While it works, it's quite
verbose, it stops at the first error, and it's hard to understand from it what
is really allowed in the file. I find working with unstructured data really
impractical: every single property is optional, every typo (&lt;tt class=&quot;docutils literal&quot;&gt;schmea&lt;/tt&gt;) should
be explicitly checked.&lt;/p&gt;
&lt;p&gt;In order to check the configuration entirely before throwing it into the rest
of the program, and in order to be able to document precisely what is a valid
configuration file, I've taken a look at &lt;a class=&quot;reference external&quot; href=&quot;https://json-schema.org/&quot;&gt;JSON Schema&lt;/a&gt;. Now, that's
deceiving: validating YAML with JSON Schema? That turns out to be no problem,
because the validation doesn't happen at syntactical level, but it is
performed on the objects after parsing. Limiting the YAML to the same data
types JSON can handle it will work no problem.&lt;/p&gt;
&lt;p&gt;JSON Schemas are quite simple to define: I started thinking &amp;quot;noooo, another
huge thing to learn just for a simple thing...&amp;quot; but actually it's not
difficult at all: it didn't take too long to put together a &lt;a class=&quot;reference external&quot; href=&quot;https://github.com/dvarrazzo/pg_seldump/blob/eae1d8634444b0fd1bfeff4f75f89116a975b736/seldump/schema/config.yaml&quot;&gt;schema for
pg_seldump configuration file&lt;/a&gt; (in YAML of course). However, performing
validation (using the &lt;a class=&quot;reference external&quot; href=&quot;https://pypi.org/project/jsonschema/&quot;&gt;jsonschema&lt;/a&gt; Python package) the results are not entirely
satisfactory. For instance, this is a configuration file containing 4 errors:&lt;/p&gt;
&lt;pre class=&quot;code YAML literal-block&quot;&gt;
&lt;span class=&quot;ln&quot;&gt;1 &lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;# badconfig.yaml&lt;/span&gt;
&lt;span class=&quot;ln&quot;&gt;2 &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;db_objects&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;ln&quot;&gt;3 &lt;/span&gt;  &lt;span class=&quot;p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;10&lt;/span&gt;
&lt;span class=&quot;ln&quot;&gt;4 &lt;/span&gt;    &lt;span class=&quot;nt&quot;&gt;action&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;download&lt;/span&gt;
&lt;span class=&quot;ln&quot;&gt;5 &lt;/span&gt;    &lt;span class=&quot;nt&quot;&gt;kid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;table&lt;/span&gt;
&lt;span class=&quot;ln&quot;&gt;6 &lt;/span&gt;    &lt;span class=&quot;nt&quot;&gt;adjust_score&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;twelve&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;It can be easily validated against the schema:&lt;/p&gt;
&lt;pre class=&quot;code pycon literal-block&quot;&gt;
&lt;span class=&quot;kn&quot;&gt;&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;jsonschema&lt;/span&gt;
&lt;span class=&quot;gp&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;yaml&lt;/span&gt;
&lt;span class=&quot;go&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;schema&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;yaml&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;load&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;seldump/schema/config.yaml&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;gp&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;validator&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;jsonschema&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Draft7Validator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;schema&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;go&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;config&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;yaml&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;load&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;badconfig.yaml&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;gp&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;message&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;validator&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;iter_errors&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;go&quot;&gt;
Additional properties are not allowed ('kid' was unexpected)
10 is not of type 'string'
'twelve' is not of type 'integer'
'download' is not one of ['dump', 'skip', 'error', 'ref']&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;However these error messages, as informative as they can be, have lost the
context of where they originated. Sure 10 is not a string, but good luck
finding the right &amp;quot;10&amp;quot; into a large file. The problem comes from that same
characteristic that allowed us to validate a YAML file against a JSON schema
expressed in a YAML file: everything is based on Python plain objects
(scalars, dicts, lists) and the information of what line in what file that
value came from is long lost.&lt;/p&gt;
&lt;p&gt;In order to overcome the problem, the idea is to attach file and line
information, available at parsing time, to the parsed objects. In a previous
approximation of the solution I had &lt;a class=&quot;reference external&quot; href=&quot;https://github.com/dvarrazzo/pg_seldump/blob/96c811b272130d7492c62ba89216ab537dbd4d41/seldump/yaml.py&quot;&gt;only the dictionaries&lt;/a&gt; subclassed to
attach them their position. In case of error, the name of the file and the
first line of the dictionary would have been printed: better than nothing I
guess, but not perfect (in the above example any error would have been
reported at line 3).&lt;/p&gt;
&lt;p&gt;With the introduction of the JSON schema validator I got back on the
customized YAML parser. First I used &lt;a class=&quot;reference external&quot; href=&quot;https://github.com/dvarrazzo/pg_seldump/blob/eae1d8634444b0fd1bfeff4f75f89116a975b736/seldump/yaml.py#L89&quot;&gt;more customization&lt;/a&gt;, subclassing lists
and wrapping scalars to memorize their positions and the position of their
content. The scalars themselves don't remember the attribute they are attached
to: the &lt;tt class=&quot;docutils literal&quot;&gt;10&lt;/tt&gt; above knows it came from line 3 of a file, but not that it was
the tentative &lt;tt class=&quot;docutils literal&quot;&gt;name&lt;/tt&gt; of an object. So the idea was to further instrument the
containers returned by the YAML parser, and memorize item by item what line
the values are parsed from. When a schema validation error is found,
&lt;tt class=&quot;docutils literal&quot;&gt;jsonschema&lt;/tt&gt; errors have an useful &lt;tt class=&quot;docutils literal&quot;&gt;path&lt;/tt&gt; attribute describing in what
object the error was found (for instance &lt;tt class=&quot;docutils literal&quot;&gt;['db_objects', 0, 'name']&lt;/tt&gt; for the
&amp;quot;10&amp;quot; error). So, if the last element is a string and the penultimate is a
dictionary, there is enough information to &lt;a class=&quot;reference external&quot; href=&quot;https://github.com/dvarrazzo/pg_seldump/blob/eae1d8634444b0fd1bfeff4f75f89116a975b736/seldump/config.py#L135-L167&quot;&gt;associate it back to the original
file and position&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The result I think is very user friendly:&lt;/p&gt;
&lt;pre class=&quot;literal-block&quot;&gt;
$ pg_seldump --test badconfig.yaml
ERROR at badconfig.yaml:3: name: 10 is not of type 'string'
ERROR at badconfig.yaml:4: action: 'download' is not one of ['dump', 'skip', 'error']
ERROR at badconfig.yaml:5: Additional properties are not allowed ('kid' was unexpected)
ERROR at badconfig.yaml:6: adjust_score: 'twelve' is not of type 'integer'
&lt;/pre&gt;
&lt;p&gt;It wasn't possible to express everything in the JSON schema: demanding at most
one between &lt;tt class=&quot;docutils literal&quot;&gt;name&lt;/tt&gt; and &lt;tt class=&quot;docutils literal&quot;&gt;names&lt;/tt&gt; for in rule objects seems quite difficult
and... I don't think a regular expression exists to verify that a certain
string is a valid regular expression, does it? So certain finer checks are
still performed a step after schema validation, but still before handing
control to the rest of the program. However, emitting all the errors in one
go, together with the precise location where they occurred, makes the program
an ally rather than an opponent. &lt;em&gt;This is a program I would like to use.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Enough of YAML and configuration! Now I'm looking forward to dive into the
problem of navigating the graph of the tables across foreign keys and to
generate dynamically the nested queries to extract a consistent sample of
data, watching for the pitfalls of circular foreign keys and self-referencing
tables...&lt;/p&gt;
&lt;/div&gt;
</content>
  </entry>
  <entry xml:base="https://www.varrazzo.com/blog/2020/02/23/a-website/">
    <title type="text">A Website!</title>
    <id>urn:uuid:9ef98bd1-11e2-3b83-8c1c-2867fef80f27</id>
    <updated>2020-02-23T00:00:00Z</updated>
    <link href="https://www.varrazzo.com/blog/2020/02/23/a-website/" />
    <author>
      <name>Daniele Varrazzo</name>
    </author>
    <content type="html">&lt;p&gt;Time of changes.&lt;/p&gt;
&lt;p&gt;Last week, after 12 years working for the same company, I have terminated my
employment. It was a destabilising moment, followed by a wave of excitement
that I'm still riding, about what is to come.&lt;/p&gt;
&lt;p&gt;I still don't know about my next moves: for sure a break, and a journey
already organized in a couple of weeks, after which I doubt I will be able to
remain without working for a long time...&lt;/p&gt;
&lt;p&gt;My biggest desire would be to try and earn some living with &lt;a class=&quot;reference external&quot; href=&quot;/software/&quot;&gt;free software
projects&lt;/a&gt;. Some of my projects are already widely used, and I have new
features in mind to write. Other projects haven't been widely released, but I
have used them in my previous company and they are very promising. I have
recently set up a &lt;a class=&quot;reference external&quot; href=&quot;https://github.com/sponsors/dvarrazzo/&quot;&gt;funding page&lt;/a&gt;: and I'm curious to see if it will become
anything relevant.&lt;/p&gt;
&lt;p&gt;At the same time, I am enjoying more and more practicing &lt;a class=&quot;reference external&quot; href=&quot;/photo/&quot;&gt;photography&lt;/a&gt;, so I
was also feeling the need to put somewhere an photographic portfolio, not only
a software one.&lt;/p&gt;
&lt;p&gt;But let's stop talking about me. Let's talk about this website, because
putting it together was actually cool.&lt;/p&gt;
&lt;div class=&quot;section&quot; id=&quot;how-was-it-made&quot;&gt;
&lt;h3&gt;How was it made&lt;/h3&gt;
&lt;p&gt;Unless you need to support several users editing the same content
concurrently, each one with different permissions, a database-backed website
is not really needed. And if a website is just a bunch of static pages, nice
things will happen:&lt;/p&gt;
&lt;ul class=&quot;simple&quot;&gt;
&lt;li&gt;you can version it in Git or in your favourite SCM of the past,&lt;/li&gt;
&lt;li&gt;it's very simple to serve: just a bunch of files on a webserver,&lt;/li&gt;
&lt;li&gt;it will never be pwned,&lt;/li&gt;
&lt;li&gt;you can easily find someone to serve it for you: &lt;a class=&quot;reference external&quot; href=&quot;https://pages.github.com/&quot;&gt;GitHub pages&lt;/a&gt; for
instance.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Of course I don't want to write HTML by hand, so off I went looking for a
static website generator. As we mentioned GitHub pages, &lt;a class=&quot;reference external&quot; href=&quot;https://jekyllrb.com/docs/github-pages/&quot;&gt;Jekyll&lt;/a&gt; did come to
mind, but it has a couple of shortcomings:&lt;/p&gt;
&lt;ul class=&quot;simple&quot;&gt;
&lt;li&gt;it's written in Ruby, which is not my expertise so, in case I needed a quick
hack, there would be a lot of overhead;&lt;/li&gt;
&lt;li&gt;it uses &lt;a class=&quot;reference external&quot; href=&quot;https://daringfireball.net/projects/markdown/&quot;&gt;Markdown&lt;/a&gt; as markup languages, which is &lt;a class=&quot;reference external&quot; href=&quot;http://www.zverovich.net/2016/06/16/rst-vs-markdown.html&quot;&gt;largely inferior&lt;/a&gt; to
&lt;a class=&quot;reference external&quot; href=&quot;https://en.wikipedia.org/wiki/ReStructuredText&quot;&gt;reStructuredText&lt;/a&gt; in design and tooling.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Shopping around, I found &lt;a class=&quot;reference external&quot; href=&quot;https://www.getlektor.com/&quot;&gt;Lektor&lt;/a&gt;, which seems actually a nifty thing. It uses
Markdown out-of-the-box as well, but it is easy to &lt;a class=&quot;reference external&quot; href=&quot;https://github.com/fschulze/lektor-rst&quot;&gt;add reST using a
plugin&lt;/a&gt;. For an example, &lt;a class=&quot;reference external&quot; href=&quot;https://raw.githubusercontent.com/dvarrazzo/www.varrazzo.com/master/content/blog/a-website/contents.lr&quot;&gt;this is this article source&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;I tried this setup with the &lt;a class=&quot;reference external&quot; href=&quot;https://www.psycopg.org/&quot;&gt;psycopg website&lt;/a&gt;, which I migrated from being a
Django website to &lt;a class=&quot;reference external&quot; href=&quot;https://github.com/psycopg/psycopg-website/&quot;&gt;static content&lt;/a&gt;, and it was quite a simple task.&lt;/p&gt;
&lt;p&gt;Then I went around shopping for a nice template: I found a cool one called
&lt;a class=&quot;reference external&quot; href=&quot;achtungthemes.com/borano/&quot;&gt;Borano&lt;/a&gt; (look at the &lt;a class=&quot;reference external&quot; href=&quot;/photo/&quot;&gt;portfolio&lt;/a&gt;, it is a joy...). Lektor supports &lt;a class=&quot;reference external&quot; href=&quot;https://palletsprojects.com/p/jinja/&quot;&gt;Jinja&lt;/a&gt;
templates to spit HTML, so now I am in the process of &lt;a class=&quot;reference external&quot; href=&quot;https://github.com/dvarrazzo/www.varrazzo.com/blob/e02696529e58b1b72bb9067c91e1c783895b8912/templates/page.html&quot;&gt;converting&lt;/a&gt; the
template to Jinja, while at the same time I try and and work out what is that
I have to say.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;section&quot; id=&quot;the-workflow&quot;&gt;
&lt;h3&gt;The workflow&lt;/h3&gt;
&lt;p&gt;All it takes to edit the website is:&lt;/p&gt;
&lt;ul class=&quot;simple&quot;&gt;
&lt;li&gt;use my favourite editor (no pesky HTML textarea) to create and edit pages;&lt;/li&gt;
&lt;li&gt;running &lt;tt class=&quot;docutils literal&quot;&gt;make serve&lt;/tt&gt; the website preview is immediately available on
&lt;tt class=&quot;docutils literal&quot;&gt;&lt;span class=&quot;pre&quot;&gt;http://localhost:5000/&lt;/span&gt;&lt;/tt&gt;;&lt;/li&gt;
&lt;li&gt;commit and push to &lt;a class=&quot;reference external&quot; href=&quot;https://github.com/dvarrazzo/www.varrazzo.com/&quot;&gt;the website repos&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;This is where the human work of adding or changing content finishes. What will
happen behind the scene will be:&lt;/p&gt;
&lt;ul class=&quot;simple&quot;&gt;
&lt;li&gt;&lt;a class=&quot;reference external&quot; href=&quot;https://travis-ci.org/dvarrazzo/www.varrazzo.com&quot;&gt;Travis will render the pages&lt;/a&gt; and push the result to &lt;a class=&quot;reference external&quot; href=&quot;https://github.com/dvarrazzo/dvarrazzo.github.io&quot;&gt;the GitHub pages
repos&lt;/a&gt;;&lt;/li&gt;
&lt;li&gt;from there the website is immediately published on &lt;a class=&quot;reference external&quot; href=&quot;https://www.varrazzo.com/&quot;&gt;https://www.varrazzo.com/&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;That's it.&lt;/p&gt;
&lt;p&gt;I don't think this setup can work for everyone. I could probably set up the
system to some non tech friend and explain what to do, but they should at
least be comfortable to use git for their regular workflow. It might be
actually not such a high bar: if someone would like to try and start
publishing a small website please let me know!&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;section&quot; id=&quot;bonus-comments&quot;&gt;
&lt;h3&gt;Bonus: comments&lt;/h3&gt;
&lt;p&gt;A blog is not a blog if it doesn't have comments. But open comments take spam
with them, which in my experience got very boring to administer.&lt;/p&gt;
&lt;p&gt;I was thinking to use GitHub issues to store my comments, in order to leverage
their anti-spam system, whilst still being able to take them out in case I'd
like to migrate to something else. But apparently it's difficult to have a new
idea on Internet, and I found a few implementations already written.&lt;/p&gt;
&lt;p&gt;&lt;a class=&quot;reference external&quot; href=&quot;https://utteranc.es/&quot;&gt;utteranc.es&lt;/a&gt; seems a very good one and quick to set up, so here it is... 👇&lt;/p&gt;
&lt;/div&gt;
</content>
  </entry>
</feed>
